<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="classMapper">

	<resultMap type="ClassDetail" id="class_rm">
		<id property="classNo" column="CLASS_NO" />
		
		<result property="classArea" column="CLASS_AREA" />
		<result property="classType" column="CLASS_TYPE" />
		<result property="classPerson" column="CLASS_PERSON" />
		<result property="classMinPerson" column="CLASS_MIN_PERSON" />
		<result property="classMaxPerson" column="CLASS_MAX_PERSON" />
		<result property="className" column="CLASS_NM" />
		<result property="classIntro" column="CLASS_INTRO" />
		<result property="classLevel" column="CLASS_LEVEL" />
		<result property="classReqDate" column="CLASS_REQ_DT" />
		<result property="classStatus" column="CLASS_ST" />
		<result property="categoryNo" column="CATG_NO" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="categoryDetailNo" column="CT_DETAIL_NO" />
	</resultMap>

	<resultMap type="ClassDetailImage" id="classImage_rm">
		<id property="thImgNo" column="TH_IMG_NO"/>
		
		<result property="thImgNm" column="TH_IMG_NM"/>
		<result property="thImgLevel" column="TH_IMG_LEVEL"/>
		<result property="classNo" column="CLASS_NO"/>
	</resultMap>


	<!-- 클래스 등록 -->
	<insert id="classInsert" useGeneratedKeys="true" parameterType="ClassDetail">
		
		<selectKey order="BEFORE" resultType="_int" keyProperty="classNo">
			SELECT SEQ_CLASS_NO.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO CLASS VALUES(
		    #{classNo}, #{classArea}, #{classType}, #{classPerson}, #{classMinPerson}, #{classMaxPerson}, 
		    #{className}, #{classIntro}, #{classLevel}, DEFAULT, 0, #{categoryNo}, #{memberNo}, #{categoryDetailNo}
		)
	</insert>
	
	<!-- 클래스 이미지 등록 -->
	<insert id="classImageInsert" parameterType="java.util.List">
		INSERT INTO THUMBNAIL_IMG
		SELECT SEQ_TH_IMG_NO.NEXTVAL, A.* FROM
		
		<foreach collection="list" item="img" open="(" close=") A" separator=" UNION ALL ">
			SELECT #{img.thImgNm} TH_IMG_NM,
				   #{img.thImgLevel} TH_IMG_LEVEL,
				   #{img.classNo} CLASS_NO
			FROM DUAL
		</foreach>
	</insert>
	
	<!-- 강사 페이지  -->
	<!-- 강사 클래스 목록 조회 - 1회차 클래스 검색 -->
	<select id="selectClassList" resultMap="class_rm">
		SELECT CLASS_NO, CLASS_NM FROM CLASS
		JOIN EPISODE A USING (CLASS_NO)
		JOIN EP_SCHEDULE B USING (EP_NO)
		WHERE MEMBER_NO = #{memberNo} AND EP_COUNT = 1
	</select>
	
	<!-- 강사 클래스 목록 조회 - 1회차 이상인 클래스 검색 -->
	<select id="selectEpisodeList">
		SELECT * FROM CLASS
		JOIN EPISODE A USING (CLASS_NO)
		JOIN EP_SCHEDULE B USING (EP_NO)
		WHERE CLASS_NO= #{classNo} AND EP_COUNT != 1
	</select>
	




</mapper>
